Hacking - The Art of Exploitation
=========================== 

## GCC

**GCC**: GNU Compiler Collection

- Specifying a output:
`gcc sourcefile.c -o outputfile`
- Add debug information: `-g`
`gcc -g sourcefile.c -o outputfile`

## OBJDUMP

**objdump**: display information from object files.

- See the assembly produced using Intel syntax (grep force to get the last 20 lines after it matches "main.:" pattern)
`objdump -M intel -D a.out | grep -A20 main.:`

## GDB

**GDB**: The GNU Debugger

- Starts gdb on "quiet" mode
`gdb -q ./a.out`
- Set a breakpoint
  `break main`
- Kick off
  `run`
- List registers info
`info registers`
`i r`
- Force Intel syntax on GDB
`set disassembly-flavor intel`
- Show the source code (compile it with debug info, the **g** flag -> `gcc -g sourcefile.c`)
`list`
- Disassemble dump (show the assembly code of a function - it should be specified)
`disassemble main`
- Show a specific register info
`info register eip`
`i r eip`
* Examine a memory address (expects 2 params, the address and the display format). Valid display formats:
```
o = octal
x = hexadecimal
u = decimal
t = binary
```
Examples:
```
x/o 0x40053e
x/x $eip
x/x $eip
x/t $eip
```
- Examine multiples units at the target address
`x/2x $eip`
- The default size of a single unit is a WORD (4 bytes). Valid sizes
```
b = a byte
h = a halfword = 2 bytes
w = a word = 4 bytes
g = a giant word = 8 bytes
i = instruction
c = show chars
s = show a string
```
Examples:
```
x/8xb $eip
x/8xh $eip
x/8xw $eip
x/i $eip
x/6cb 0x4005f4
x/s 0x4005f4
```
- Print an operation value
`print $rbp - 4`
- Go to next instruction
`nexti`
- Continue to the next breakpoint
`continue`
---

## Registers
#### General purpose registers
- EAX - Accumulator
- EBX - Base
- ECX - Counter
- EDX - Data

#### Pointers and Indexes registers
- ESP - Stack pointer
- EBP - Base pointer
- ESI - Source index
- EDI - Destination Index

---

## Intel Syntax
#### General syntax
`operation <destination>, <source>`

Destination and source can be:
- Register
- Memory Address
- Value

x86 processor values are stored in little-endian byte order.
**Little-Endian**: the least significant byte is stored first

---

#### BC

**bc**: an arbitrary precision calculator language
```
> bc -ql
> 1 + 2
3
> quit
``` 

---

### Tricks

- To enable address randomization on GDB do this on a GDB session or on a `.gdbinit` file:
`set disable-randomization off`
- Don't recognize built-in functions that do not begin with `__builtin_` as prefix: `-fno-builtin`. This will avoid GDB optimize your code and do the function calls that you needed while debugging (and stepping through them).
`gcc -fno-builtin source.c -o output`